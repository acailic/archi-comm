#!/bin/sh
# .husky/pre-push
# Pre-push hook that runs before code is pushed to remote
# Runs tests and checks to catch issues before CI
# RELEVANT FILES: .husky/pre-commit, package.json, config/coverage.config.json

. "$(dirname "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."
echo ""

# Run type checking
echo "ğŸ“ Type checking..."
npm run type-check || {
  echo "âŒ Type check failed"
  echo "ğŸ’¡ Fix type errors before pushing"
  exit 1
}
echo "âœ… Type check passed"
echo ""

# Run unit tests
echo "ğŸ§ª Running unit tests..."
npm run test:run || {
  echo "âŒ Unit tests failed"
  echo "ğŸ’¡ Fix failing tests before pushing"
  exit 1
}
echo "âœ… Unit tests passed"
echo ""

# Check for unused code
echo "ğŸ” Checking for unused code..."
npm run unused:check || {
  echo "âš ï¸  Unused code detected"
  echo "ğŸ’¡ Consider removing unused code or use --no-verify to skip"
}
echo ""

# Verify test coverage
echo "ğŸ“Š Verifying test coverage..."
npm run test:coverage:check || {
  echo "âŒ Coverage thresholds not met"
  echo "ğŸ’¡ Add tests to improve coverage or update thresholds in config/coverage.config.json"
  exit 1
}
echo "âœ… Coverage thresholds met"
echo ""

echo "âœ¨ All pre-push checks passed! Ready to push."
